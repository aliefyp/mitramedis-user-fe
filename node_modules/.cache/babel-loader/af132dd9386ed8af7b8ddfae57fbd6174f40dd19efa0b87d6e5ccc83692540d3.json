{"ast":null,"code":"import _objectSpread from\"/Users/risky.setiyawan/Documents/Proj/mitramedis-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/risky.setiyawan/Documents/Proj/mitramedis-frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/risky.setiyawan/Documents/Proj/mitramedis-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from\"react\";import PageHeading from\"components/PageHeading\";import useToaster from\"context/ToasterContext\";import StockPurchaseTable from\"./components/StockPurchaseTable\";import StockPurchaseForm from\"./components/StockPurchaseForm\";import{usePurchase}from\"api/purchase\";import ModalConfirmation from\"components/organism/ModalConfirmation\";import{useNavigate}from\"react-router-dom\";import{useForm}from\"react-hook-form\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StockPurchase=function StockPurchase(){var _purchase$data2;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showConfirmation=_useState2[0],setShowConfirmation=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showPurchaseStatus=_useState4[0],setShowPurchaseStatus=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isPurchaseSuccess=_useState6[0],setPurchaseSuccess=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),entryData=_useState8[0],setEntryData=_useState8[1];var purchase=usePurchase();var _useToaster=useToaster(),openToaster=_useToaster.open;var navigate=useNavigate();var form=useForm();var addItem=function addItem(val){setEntryData([].concat(_toConsumableArray(entryData),[val]));};var handleDeleteEntry=function handleDeleteEntry(index){setEntryData(entryData.filter(function(_,i){return i!==index;}));};var handleSubmitPurchase=function handleSubmitPurchase(){if(!entryData.length){openToaster({title:\"Belum ada data\",message:\"Harap tambahkan data pembelian terlebih dahulu\",variant:\"error\",autoClose:true});return;}setShowConfirmation(true);};var handleConfirmClick=function handleConfirmClick(){setShowConfirmation(false);var _entryData$=entryData[0],invoice=_entryData$.invoice,date=_entryData$.date,supplier_id=_entryData$.supplier_id;var payload={invoice:invoice,date:date,supplier_id:supplier_id,stock:entryData.map(function(item){return{stock_id:item.stock_id,qty:Number(item.qty),cogs:Number(item.cogs),sales_price:item.sales_price,total:Number(item.qty)*Number(item.cogs),expired_date:item.expired_date};})};purchase.mutate(payload);};var handleGoToStock=function handleGoToStock(){navigate(\"/stok\");};var handleBlankForm=function handleBlankForm(){setShowPurchaseStatus(false);form.reset();};useEffect(function(){if(purchase.isSuccess){var _purchase$data;setShowPurchaseStatus(true);setPurchaseSuccess(((_purchase$data=purchase.data)===null||_purchase$data===void 0?void 0:_purchase$data.status)===200);}},[(_purchase$data2=purchase.data)===null||_purchase$data2===void 0?void 0:_purchase$data2.status,purchase.isSuccess]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PageHeading,{title:\"Pembelian\",breadcrumbs:[{text:\"Stok\",url:\"/stok\"},{text:\"Pembelian\"}]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(StockPurchaseForm,{form:form,onSubmit:addItem}),/*#__PURE__*/_jsx(StockPurchaseTable,{items:entryData,onDelete:handleDeleteEntry,onSubmit:handleSubmitPurchase})]})]}),/*#__PURE__*/_jsx(ModalConfirmation,{open:showConfirmation,onClose:function onClose(){return setShowConfirmation(false);},type:\"info\",title:\"Konfirmasi\",message:\"Pastikan semua data yang dimasukkan sudah benar\",primaryAction:\"Simpan\",onPrimaryActionClick:handleConfirmClick,secondaryAction:\"Periksa kembali\",onSecondaryActionClick:function onSecondaryActionClick(){return setShowConfirmation(false);}}),/*#__PURE__*/_jsx(ModalConfirmation,_objectSpread(_objectSpread({open:showPurchaseStatus,type:isPurchaseSuccess?\"success\":\"error\",title:isPurchaseSuccess?\"Berhasil\":\"Gagal\",message:isPurchaseSuccess?\"Berhasil menyimpan pembelian\":\"Gagal menyimpan data\",primaryAction:isPurchaseSuccess?\"Ke Manajemen Stok\":\"Tutup\",onPrimaryActionClick:isPurchaseSuccess?handleGoToStock:function(){return setShowPurchaseStatus(false);}},isPurchaseSuccess&&{secondaryAction:\"Pembelian Baru\",onSecondaryActionClick:handleBlankForm}),{},{onClose:handleBlankForm}))]});};export default StockPurchase;","map":{"version":3,"names":["useEffect","useState","PageHeading","useToaster","StockPurchaseTable","StockPurchaseForm","usePurchase","ModalConfirmation","useNavigate","useForm","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","StockPurchase","_purchase$data2","_useState","_useState2","_slicedToArray","showConfirmation","setShowConfirmation","_useState3","_useState4","showPurchaseStatus","setShowPurchaseStatus","_useState5","_useState6","isPurchaseSuccess","setPurchaseSuccess","_useState7","_useState8","entryData","setEntryData","purchase","_useToaster","openToaster","open","navigate","form","addItem","val","concat","_toConsumableArray","handleDeleteEntry","index","filter","_","i","handleSubmitPurchase","length","title","message","variant","autoClose","handleConfirmClick","_entryData$","invoice","date","supplier_id","payload","stock","map","item","stock_id","qty","Number","cogs","sales_price","total","expired_date","mutate","handleGoToStock","handleBlankForm","reset","isSuccess","_purchase$data","data","status","children","breadcrumbs","text","url","className","onSubmit","items","onDelete","onClose","type","primaryAction","onPrimaryActionClick","secondaryAction","onSecondaryActionClick","_objectSpread"],"sources":["/Users/risky.setiyawan/Documents/Proj/mitramedis-frontend/src/pages/StockPurchase/index.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { PurchaseFormType } from \"types/purchase\";\nimport PageHeading from \"components/PageHeading\";\nimport useToaster from \"context/ToasterContext\";\nimport StockPurchaseTable from \"./components/StockPurchaseTable\";\nimport StockPurchaseForm from \"./components/StockPurchaseForm\";\nimport { usePurchase } from \"api/purchase\";\nimport ModalConfirmation from \"components/organism/ModalConfirmation\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useForm } from \"react-hook-form\";\n\nconst StockPurchase = () => {\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [showPurchaseStatus, setShowPurchaseStatus] = useState(false);\n  const [isPurchaseSuccess, setPurchaseSuccess] = useState(false);\n  const [entryData, setEntryData] = useState<PurchaseFormType[]>([]);\n  const purchase = usePurchase();\n  const { open: openToaster } = useToaster();\n  const navigate = useNavigate();\n\n  const form = useForm<PurchaseFormType>();\n\n  const addItem = (val: PurchaseFormType) => {\n    setEntryData([...entryData, val]);\n  };\n\n  const handleDeleteEntry = (index: number) => {\n    setEntryData(entryData.filter((_, i) => i !== index));\n  };\n\n  const handleSubmitPurchase = () => {\n    if (!entryData.length) {\n      openToaster({\n        title: \"Belum ada data\",\n        message: \"Harap tambahkan data pembelian terlebih dahulu\",\n        variant: \"error\",\n        autoClose: true,\n      });\n      return;\n    }\n\n    setShowConfirmation(true);\n  };\n\n  const handleConfirmClick = () => {\n    setShowConfirmation(false);\n\n    const { invoice, date, supplier_id } = entryData[0];\n    const payload = {\n      invoice,\n      date,\n      supplier_id,\n      stock: entryData.map((item) => ({\n        stock_id: item.stock_id,\n        qty: Number(item.qty),\n        cogs: Number(item.cogs),\n        sales_price: item.sales_price,\n        total: Number(item.qty) * Number(item.cogs),\n        expired_date: item.expired_date,\n      })),\n    };\n\n    purchase.mutate(payload);\n  };\n\n  const handleGoToStock = () => {\n    navigate(\"/stok\");\n  };\n\n  const handleBlankForm = () => {\n    setShowPurchaseStatus(false);\n    form.reset();\n  };\n\n  useEffect(() => {\n    if (purchase.isSuccess) {\n      setShowPurchaseStatus(true);\n      setPurchaseSuccess(purchase.data?.status === 200);\n    }\n  }, [purchase.data?.status, purchase.isSuccess]);\n\n  return (\n    <>\n      <div>\n        <PageHeading\n          title=\"Pembelian\"\n          breadcrumbs={[{ text: \"Stok\", url: \"/stok\" }, { text: \"Pembelian\" }]}\n        />\n\n        <div className=\"space-y-4\">\n          <StockPurchaseForm form={form} onSubmit={addItem} />\n          <StockPurchaseTable\n            items={entryData}\n            onDelete={handleDeleteEntry}\n            onSubmit={handleSubmitPurchase}\n          />\n        </div>\n      </div>\n\n      <ModalConfirmation\n        open={showConfirmation}\n        onClose={() => setShowConfirmation(false)}\n        type=\"info\"\n        title=\"Konfirmasi\"\n        message=\"Pastikan semua data yang dimasukkan sudah benar\"\n        primaryAction=\"Simpan\"\n        onPrimaryActionClick={handleConfirmClick}\n        secondaryAction=\"Periksa kembali\"\n        onSecondaryActionClick={() => setShowConfirmation(false)}\n      />\n\n      <ModalConfirmation\n        open={showPurchaseStatus}\n        type={isPurchaseSuccess ? \"success\" : \"error\"}\n        title={isPurchaseSuccess ? \"Berhasil\" : \"Gagal\"}\n        message={\n          isPurchaseSuccess\n            ? \"Berhasil menyimpan pembelian\"\n            : \"Gagal menyimpan data\"\n        }\n        primaryAction={isPurchaseSuccess ? \"Ke Manajemen Stok\" : \"Tutup\"}\n        onPrimaryActionClick={\n          isPurchaseSuccess\n            ? handleGoToStock\n            : () => setShowPurchaseStatus(false)\n        }\n        {...(isPurchaseSuccess && {\n          secondaryAction: \"Pembelian Baru\",\n          onSecondaryActionClick: handleBlankForm,\n        })}\n        onClose={handleBlankForm}\n      />\n    </>\n  );\n};\n\nexport default StockPurchase;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}